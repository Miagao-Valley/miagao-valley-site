---
import Grid from "./Grid.astro";
---

<Grid variant="small" id="languages" />

<script>
    import { Chart } from "chart.js/auto";
    import { languages } from "../content/data/githubStats.js";
    import { colors } from "../content/data/colors.js";

    const langs: string[] = [];
    languages.forEach((lang) => {
        langs.push(lang.name);
    });

    const values: number[] = [];
    languages.forEach((lang) => {
        values.push(lang.value);
    });

    const container = document.querySelector("#languages.grid")!;

    Chart.defaults.font.family = "Public Sans";
    Chart.defaults.font.size = 14;

    function renderChart(label: string[], values: number[]) {
        const li = document.createElement("li");
        li.style.display = "flex";
        li.style.justifyContent = "center";

        const chartContainer = document.createElement("div");
        chartContainer.style.width = "400px";

        const canvas = document.createElement("canvas");
        canvas.id = label;

        chartContainer.appendChild(canvas);
        li.appendChild(chartContainer);
        container.appendChild(li);

        const dataset = {
            labels: label,
            datasets: [
                {
                    data: values,
                    backgroundColor: colors,
                    hoverOffset: 4,
                    borderColor: "rgba(1, 1, 1, 0)",
                },
            ],
        };

        const chart = new Chart(canvas, {
            type: "pie",
            data: dataset,
            options: {
                animations: { animateScale: "false" },
                responsive: "true",
            },
        });

        return chart;
    }

    renderChart(langs, values);
</script>
